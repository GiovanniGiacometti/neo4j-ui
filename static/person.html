<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/css.css">
    <title>Neo4j ContactTracing</title>
</head>

<body>
<div id="graph">
</div>
<div role="navigation" class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="row">
            
            <div class="navbar-header col-sm-6 col-md-6">
                <div class="navbar-brand">
                    <p><a href="/homepage">Neo4j ContactTracing </a></p>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="row">
            
    <div class="navbar-header col-sm-6 col-md-6">
        <div class="navbar-brand">
            <h3 id="person"></h3>
        </div>
    </div>
</div>

<div class="col-sm-6 col-md-6">
    <ul class="nav navbar-nav">
        <li>
            <form role="search" class="navbar-form" id="search">
                <button class="btn btn-default"id="insertcovidtest_button" type="button">Insert Covid Test</button>
                <button class="btn btn-default"id="insertvaccine_button" type="button">Insert Vaccine</button>
            </form>
        </li>
    </ul>
</div>

<div id = "hiddendiv_covidtest" class="col-sm-6 col-md-6">
    <ul class="nav navbar-nav">
        <li>
            <form role="search" class="navbar-form" id="search">
                <div class="form-group">
                    <input type="text" value="" placeholder="Date" class="form-control" id="date_input">
                </div>
                <div class="form-group">
                    <input type="text" value="" placeholder="Type" class="form-control" id="type_input">
                </div>
                <div class="form-group">
                    <input type="text" value="" placeholder="Result" class="form-control" id="result_input">
                </div>
                
                <button class="btn btn-default"id="covid_sendtodb_button" type="button">Insert Covid Test</button>
                

            </form>
        </li>
    </ul>
</div>

<div id = "hiddendiv_vaccine" class="col-sm-6 col-md-6">
    <ul class="nav navbar-nav">
        <li>
            <form role="search" class="navbar-form" id="search">
                <div class="form-group">
                    <input type="text" value="" placeholder="First Dose Date" class="form-control" id="first_date_input">
                </div>
                <div class="form-group">
                    <input type="text" value="" placeholder="First Dose Date" class="form-control" id="second_date_input">
                </div>
                <div class="form-group">
                    <input type="text" value="" placeholder="Type" class="form-control" id="type_input">
                </div>
                
                <button class="btn btn-default"id="sendtodb_button" type="button">Insert Vaccine</button>
            
            </form>
        </li>
    </ul>
</div>

<div class="col-sm-6 col-md-6">
    <ul class="nav navbar-nav">
        <div class="navbar-header col-sm-6 col-md-6">
            <div class="navbar-brand">
                <div class="brand" id="person"></div>
            </div>
        </div>
    </ul>
</div>

<div class="row">
    <h3>COVID TEST</h3>

    <div class="col-md-7">

        <div class="panel panel-default">

            <div class="row">
                <div class="col-md-8 col-sm-8">
                    
                    <table id="results" class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>DATE</th>
                            <th>TYPE</th>
                            <th>RESULT</th>
                        </tr>
                        </thead>
                        <tbody id="tbodytest">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <h3>VACCINE</h3>
    <div class="col-md-7">

        <div class="panel panel-default">

            <div class="row">
                <div class="col-md-8 col-sm-8">
                    
                    <table id="results" class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>TYPE</th>
                            <th>FIRST DOSE DATE</th>
                            <th>SECOND DOSE DATE</th>
                        </tr>
                        </thead>
                        <tbody id="tbodyvaccine">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<style type="text/css">
    a {padding:5px}
    .row{
        padding:10px
    }
</style>
</body>
</html>




<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {

        $("#hiddendiv_vaccine").hide()
        $("#hiddendiv_covidtest").hide()
        
        
        $("#covid_sendtodb_button").on("click", function(){
                createCovidTest()
            });
        $("#insertcovidtest_button").on("click", function(){
                $("#hiddendiv_covidtest").toggle()
            });
        $("#insertvaccine_button").on("click", function(){
                $("#hiddendiv_vaccine").toggle()
            });

        const urlSearchParams = new URLSearchParams(window.location.search);
        params = Object.fromEntries(urlSearchParams.entries())
        p = $("#person").html(params["name"] +" " + params["surname"])
        
        function showTests(taxcode) {
            $.get("/covid-test?taxcode=" + encodeURIComponent(taxcode),
                    function (data) {
                        const tbody = $("#tbodytest").empty();
                        data.nodes.forEach(function ( covidTest){
                        $("<tr id= '" + covidTest.id + "'><td class='movie' >" + covidTest.id
                                + "</td><td>" + covidTest.date
                                + "</td><td>" + covidTest.type
                                + "</td><td>" + covidTest.result
                                + "</td></tr>"
                        ).appendTo(tbody)
                }, "json");
        })}

        function showVaccine(taxcode) {
            $.get("/vaccine?taxcode=" + encodeURIComponent(taxcode),
                    function (data) {
                        const tbody = $("#tbodyvaccine").empty();
                        data.nodes.forEach(function (vaccine){
                        s = vaccine.second_dose_date=="None" ? "" : vaccine.second_dose_date
                        $("<tr id= '" + vaccine.id + "'><td class='movie' >" + vaccine.id
                            
                                + "</td><td>" + vaccine.type
                                + "</td><td>" + vaccine.first_dose_date
                                + "</td><td>" + s
                                + "</td></tr>"
                        ).appendTo(tbody)
                }, "json");
        })}

        function createCovidTest(){
            const date = $("#date_input").val()
            const type = $("#type_input").val()
            const result = $("#result_input").val()
            
            $.get("/create-covid-test?date=" + encodeURIComponent(date) + "&type=" + encodeURIComponent(type) +
                        "&result=" + encodeURIComponent(result) + "&taxcode=" + encodeURIComponent(params["taxcode"]),
                    function (data) {
                            $("#date_input").val()
                        $("#type_input").val()
                        $("#result_input").val()
                        showTests(params["taxcode"])
                    })}

        showTests(params["taxcode"])
        showVaccine(params["taxcode"])

    });
</script>