<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/css.css">
    <title>Neo4j ContactTracing</title>
</head>

<body>
<div id="graph">
</div>
<div role="navigation" class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="row">
            
            <div class="navbar-header col-sm-6 col-md-6">
                <div class="navbar-brand">
                    <div class="brand">Neo4j ContactTracing</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="col-sm-6 col-md-6">
    <ul class="nav navbar-nav">
        <li>
            <form role="search" class="navbar-form" id="search">
                <div class="form-group">
                    <input type="text" value="" placeholder="Search for Person" class="form-control" id="search_in">
                </div>
                <button class="btn btn-default"id="search_button" type="button">Search</button>
                <button class="btn btn-default"id="getall_button" type="button">Get all</button>
            </form>
        </li>
    </ul>
</div>

<div class="row">
    
    <div class="col-md-7">
        <div class="panel panel-default">
            <div class="row">
                
                <div class="col-md-8 col-sm-8">
                    <table id="results" class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>TAXCODE</th>
                            <th>Name</th>
                            <th>Surname</th>
                            <th>Age</th>
                            <th>Address</th>
                        </tr>
                        </thead>
                        <tbody id="tbody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<style type="text/css">
    a {padding:5px}
    .row{
        padding:10px
    }
</style>

<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {

        function createButtons(name, surname, taxcode){
            
            var input1 = $('<input type="button" value="View detail" class="btn btn-default" id="detail_' + taxcode + '"/>');
            
            input1.appendTo($("#" + taxcode));
            

            input1.on("click", function(){
                window.open("person?name=" + name + "&surname=" + surname + "&taxcode=" + taxcode, '_self')
            });

            
        }

        $("#search_button").on("click", function(){
                search();
            });
        $("#getall_button").on("click", function(){
                showNames();
            });

        function showNames() {
            $.get("/graph",
                    function (data) {
                        const tbody = $("#tbody").empty();
                        data.nodes.sort(function(a, b) {
                            return a.surname > b.surname ? 1 : -1
                        });
                        data.nodes.forEach(function ( person, i){
                        $("<tr id= '" + person.taxcode + "'><td class='movie' >" + person.taxcode
                                + "</td><td>" + person.name
                                + "</td><td>" + person.surname
                                + "</td><td>" + person.age
                                + "</td><td>" + person.address 
                                + "</td></tr>"
                        ).appendTo(tbody)

                        
                        createButtons(person.name, person.surname, person.taxcode)
            }, "json");
        })}
        
        
        function search() {
            const query=$("#search_in").val();
            $.get("/search?person=" + encodeURIComponent(query),
                    function (data) {
                        const tbody = $("#tbody").empty();
                        if (!data || data.length == 0) return;
                        data.nodes.sort(function(a, b) {
                            return a.surname > b.surname ? 1 : -1
                        });
                        data.nodes.forEach(function (person){
                        $("<tr id= '" + person.taxcode + "'><td class='movie'>" + person.taxcode
                                + "</td><td>" + person.name
                                + "</td><td>" + person.surname
                                + "</td><td>" + person.age
                                + "</td><td>" + person.address 
                                + "</td></tr>"
                        ).appendTo(tbody);

                        createButtons(person.name, person.surname, person.taxcode)
                    },"json");
            return false;
        })}
        showNames()
    })
</script>


</body>
</html>
